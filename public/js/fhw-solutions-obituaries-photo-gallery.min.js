var $jscomp={scope:{},findInternal:function(a,f,b){a instanceof String&&(a=String(a));for(var e=a.length,d=0;d<e;d++){var g=a[d];if(f.call(b,g,d,a))return{i:d,v:g}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,f,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[f]=b.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,f,b,e){if(f){b=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var d=a[e];d in b||(b[d]={});b=b[d]}a=a[a.length-1];e=b[a];f=f(e);f!=e&&null!=f&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:f})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6-impl","es3");var videoNotLoaded=0,imgError,reloadVideoInterval;
(function(a){var f=oaInfo.ajax_url,b=0,e=Uppy.AwsS3,d=(new Uppy.Uppy({id:"uppyUpload",autoProceed:!0,restrictions:{maxFileSize:1E8,maxNumberOfFiles:20,minNumberOfFiles:null,allowedFileTypes:["image/*","video/*"]}})).use(Uppy.Dashboard,{target:"body",inline:!1,trigger:".edit_img",proudlyDisplayPoweredByUppy:!1,closeAfterFinish:!0,closeModalOnClickOutside:!0}).use(e,{fields:[],getUploadParameters:function(b){return fetch("https://api.obituary-assistant.com/"+g+"/s3-signature",{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},
body:JSON.stringify({filename:4<b.name.replace(/[^a-zA-Z0-9_.]+/g,"").length?b.name.replace(/[^a-zA-Z0-9_.]+/g,""):makeid(16)+b.name.match(/\.[0-9a-z]+$/i),contentType:b.type,metadata:{name:4<b.name.replace(/[^a-zA-Z0-9_.]+/g,"").length?b.name.replace(/[^a-zA-Z0-9_.]+/g,""):makeid(16)+b.name.match(/\.[0-9a-z]+$/i),caption:"",clientId:a("#client_id").val(),obitId:a("#obit_id").val()}})}).then(function(a){return a.json()}).then(function(a){console.log(">>>",a);return{method:a.method,url:a.url,fields:a.fields,
headers:a.headers}})}}),g=0<=window.location.hostname.search("dev.obituary-assistant.com")?"dev":"prod",n=function(a,b){return b?a.replace("https://obituary-assistant.s3.us-west-2.amazonaws.com","https://cdn.obituary-assistant.com"+b):a.replace("https://obituary-assistant.s3.us-west-2.amazonaws.com","https://cdn.obituary-assistant.com")};imgError=function(b){videoNotLoaded++;b.onerror="";b.src="https://cdn.obituary-assistant.com/filters:strip_exif()/fit-in/150x150/filters:fill(white)/global/please_wait.png";
0<videoNotLoaded&&(clearInterval(reloadVideoInterval),reloadVideoInterval=setInterval(function(){var b={action:"refresh_photos_and_videos",obit_id:a("#obit_id").val()};jQuery.post(f,b,function(b,d){videoNotLoaded=0;a("#fws-gallery-container").html(b);var c=jQuery("#florist-one-gallery-indicators").find("a").length;a("#photo_counter").html(" ("+c+")")},"html")},6E4));return!0};var l=function(){var e=document.getElementById("fws-gallery-modal"),g=document.getElementById("fwsPhotosVideosCarousel");document.getElementById("fwsPhotosVideosCarousel")&&
(e.addEventListener("show.bs.modal",function(c){a("#fws-gallery-modal").find(".modal-body").html("");var b=c.relatedTarget.getAttribute("data-video-num"),d=c.relatedTarget.parentElement.getAttribute("data-image-number");"photo"==c.relatedTarget.parentElement.getAttribute("data-thumbnail-type")?a("#fws-gallery-modal").find(".modal-body").html(a("#fwsPhotosVideosCarousel").find("img").eq(parseInt(d))[0].outerHTML):a("#fws-gallery-modal").find(".modal-body").html('<div class="row">'+a("#fwsPhotosVideosCarousel").find("video").eq(parseInt(b)).parent()[0].outerHTML+
"</div>")}),e.addEventListener("hide.bs.modal",function(c){a("video").each(function(){a(this).get(0).pause()})}),g.addEventListener("slide.bs.carousel",function(c){a("video").each(function(){a(this).get(0).pause()});a("#florist-one-gallery-indicators").find("a").parent().removeClass("active-img");a("#florist-one-gallery-indicators").find("a").eq(c.to).parent().addClass("active-img")}));a("div.obituary-photo-thumbnails").on("click","img",function(){if("video"==a(this).attr("data-type")){var c=a(this).attr("data-url");
a(this).attr("data-name");a(this).attr("data-description");c="<p align='center'><video controls controlsList='nodownload' poster='"+c+"-p-00002.png'><source src='"+c+".mp4' type='video/mp4'><source src='"+c+".ts' type='video/ts'><source src='"+c+".webm' type='video/webm'>Your browser does not support the video tag.</video>";a(".obituary-photo-display").html(c);a(".obituary-photo-display-button.previous").css("display","none");a(".obituary-photo-display-button.next").css("display","none")}else h(a(this).attr("data-url"),
a(this).attr("data-name"),a(this).attr("data-description"));a(".obituary-photo-display-button").css("visibility","visible")});var h=function(c,b,d){c="<p align='center'><img id='main-gallery-display' src='"+c+"' data-imageID='"+c+"'></p>";a(".obituary-photo-display").html(c);c=a("div[class='obituary-photo-thumbnails'] img[data-url='"+a("#main-gallery-display").attr("data-imageID")+"']").prev();b=a("div[class='obituary-photo-thumbnails'] img[data-url='"+a("#main-gallery-display").attr("data-imageID")+
"']").next();a(".obituary-photo-display-button.previous").css("display","block");a(".obituary-photo-display-button.next").css("display","block");"undefined"===typeof c.attr("data-url")?a(".obituary-photo-display-button.previous").addClass("placeholder"):a(".obituary-photo-display-button.previous").removeClass("placeholder");"undefined"===typeof b.attr("data-url")?a(".obituary-photo-display-button.next").addClass("placeholder"):a(".obituary-photo-display-button.next").removeClass("placeholder")},k=
{};a("#upload_photo").click(function(){var b;b=void 0===a.cookie("o-s-t")||void 0===a.cookie("o-s-u")||void 0===a.cookie("o-s-e")?0:1;0!=b&&d.getPlugin("Dashboard").openModal()});d.on("file-added",function(a){var b=URL.createObjectURL(a.data),c=new Image;c.src=b;c.onload=function(){d.setFileMeta(a.id,{width:c.width,height:c.height});URL.revokeObjectURL(b)}});d.on("complete",function(c){if(c.successful.length){for(b=0;b<c.successful.length;b++){var d=k,e=a.trim(c.successful[b].id),g=a("#obit_id").val(),
h=a.trim(a("#create-gallery-name").val()),l=n(a.trim(c.successful[b].uploadURL)),p=a.trim(a("#create-gallery-desc").val()),m;m=a.cookie("o-s-u");d[e]={obit_id:g,photo_name:h,photo_url:l,photo_description:p,photo_creator:m,resource_type:a.trim(c.successful[b].type),format:a.trim(c.successful[b].type)}}console.log(k);c={action:"obituary_assistant_add_photo",photos_data:JSON.stringify(k),obit_id:a("#obit_id").val()};jQuery.post(f,c,function(b,c){a("#fws-gallery-container").html(b);alert("Photo uploaded");
var d=jQuery("#florist-one-gallery-indicators").find("a").length;a("#photo_counter").html(" ("+d+")")},"html");k={}}});a(".obituary-photo-display-button.previous").click(function(){if(!a(this).hasClass("placeholder")){var b=a("div[class='obituary-photo-thumbnails'] img[data-url='"+a("#main-gallery-display").attr("data-imageID")+"']").prev();h(b.attr("data-url"),b.attr("data-name"),b.attr("data-description"))}});a(".obituary-photo-display-button.next").click(function(){if(!a(this).hasClass("placeholder")){var b=
a("div[class='obituary-photo-thumbnails'] img[data-url='"+a("#main-gallery-display").attr("data-imageID")+"']").next();h(b.attr("data-url"),b.attr("data-name"),b.attr("data-description"))}})};a(document).ready(function(){l()})})(jQuery);
